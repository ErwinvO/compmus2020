---
title: "Compmus2020"
author: "Erwin van Oostenbrugge"
output: 
  flexdashboard::flex_dashboard:
    storyboard: true
    theme: "paper"
    keep_md: true
---

```{r, echo = FALSE}
knitr::opts_chunk$set(
  fig.path = "README_figs/README-"
)
```

```{r setup, include=FALSE}
library(flexdashboard)
library(spotifyr)
library(tidyverse)
library(plotly)
source('Spotify.R')
library(compmus)
library(rmarkdown)
```

### 4. Mark Knopfler makes more timbrally diverse music for his solo project{data-commentary-width=300}

#### Sultans of Swing - Dire Straits

```{r}
sos <- 
    get_tidy_audio_analysis('37Tmv4NnfQeb0ZgUC4fOJj') %>% 
    compmus_align(bars, segments) %>% 
    select(bars) %>% unnest(bars) %>% 
    mutate(
        pitches = 
            map(segments, 
                compmus_summarise, pitches, 
                method = 'rms', norm = 'chebyshev')) %>% 
    mutate(
        timbre = 
            map(segments, 
                compmus_summarise, timbre, 
                method = 'rms', norm = 'euclidean'))

sos %>% 
    compmus_gather_timbre %>% 
    ggplot(
        aes(
            x = start + duration / 2, 
            width = duration, 
            y = basis, 
            fill = value)) + 
    geom_tile() +
    labs(x = 'Time (s)', y = NULL, fill = 'Magnitude') +
    scale_fill_viridis_c(option = 'E') +
    scale_fill_gradientn(limits = c(0,0.8), colors=c("black", "blue", "yellow")) +
    theme_minimal() + 
    ylab("MFCC")
```

#### What it Is - Mark Knopfler

```{r}
wii <- 
    get_tidy_audio_analysis('65f8Ca4HbZCMLhpZPTHW4O') %>% 
    compmus_align(bars, segments) %>% 
    select(bars) %>% unnest(bars) %>% 
    mutate(
        pitches = 
            map(segments, 
                compmus_summarise, pitches, 
                method = 'rms', norm = 'chebyshev')) %>% 
    mutate(
        timbre = 
            map(segments, 
                compmus_summarise, timbre, 
                method = 'rms', norm = 'euclidean'))

wii %>% 
    compmus_gather_timbre %>% 
    ggplot(
        aes(
            x = start + duration / 2, 
            width = duration, 
            y = basis, 
            fill = value)) + 
    geom_tile() +
    labs(x = 'Time (s)', y = NULL, fill = 'Magnitude') +
    scale_fill_viridis_c(option = 'E') +
    scale_fill_gradientn(limits = c(0,0.8), colors=c("black", "blue", "yellow")) +
    theme_minimal() + 
    ylab("MFCC")
```

***

To illustrate the differences and simmilarities between the two artists I've included cepstrograms of the most popular tracks of both artists according to spotify: *What it Is* by Mark Knopfler and *Sultans of Swing* by Dire Straits.

Looking at *Sultans of Swing*, it is interesting that there is a lot of activity in MFCC c02 during guitar solos. More specifically, during the softer parts of the solo segments, there is a lot of activity here. Generally speaking, there is a correlation between loudness (MFCC c01) and MFCC c02. The timbral diversity of *What it Is* is significantly greater than that of *Sultans of Swing*, although much of this diversity comes from the bridge around 160-200 seconds into the song. Perhaps this timbral diversity is one of the reasons for the relative lack of success for Mark Knopfler as a solo artist (compared to his time in Dire Straits).

Looking at MFCC c01, *What it Is* displays more dynamic diversity than *Sultans of Swing*, although it is the louder song overall. This is in line with the trends I've discovered in the previous weeks. 


### 1. Introduction

Although Mark Knopfler has been at the helm for both Dire Straits and his own solo music as songwriter and main producer, Dire Straits has been much more successful than his own music. This leads me to believe that there are some key differences between the music of Dire Straits and the music of Mark Knopfler. I will look at musical and production differences in order to conclude which of these is the most different. This will give insight in why Mark Knopfler's solo project never got the success that ultimately ended Dire Straits.

The corpus I'm using is, quite obviously, the entire discographies by both artists, aquired by the get_artist_audio_features command from spotifyr.  

### 2. Mark Knopfler makes louder, but more acoustic music {data-commentary-width=350}



```{r}
knopfler <- get_artist_audio_features(artist = "Mark Knopfler")
direstraits <- get_artist_audio_features(artist = "Dire Straits")
combined <- 
  knopfler %>% bind_rows(direstraits)

plot1 <-
  ggplot(combined, aes(x = acousticness, y = loudness, color = artist_name, label = track_name)) +
  geom_point()+
  geom_smooth(aes(color = artist_name))+
  theme_classic() +
  labs(color = "Artist") +
  ggtitle("Loudness in Relation to Acousticness")

ggplotly(plot1)

```


***

At first glance the primary difference between the two artists seems obvious: Mark Knopfler has produced more acoustic music. This is however where problems arise. Looking at the mean loudness for both artists, we would conclude that Dire Straits produced significantly louder music. This is not what would be expected, since louder mastering has become the standard and the means to do so have been developed over the years. This difference in loudness is not a stylistic feature of the music, but rather a consequence of the acousticness of the music, as can be seen in this plot. Notice how Mark Knopfler's music *in relation to its acousticness* is louder than the music of Dire Straits. 

*A lot of the softer tracks by Mark Knopfler are filmscores, which slightly skew the results shown in this graph. This is why I will not include those tracks when choosing an outlier for a chromagram.*

### 3. "Private Investigations" by Dire Straits is a unusually soft track compared to its acousticness, but nevertheless became a hit song {data-commentary-width=350}

```{r}

investigations <- 
  get_tidy_audio_analysis('5KVak7r5YKcnkmARc0hy0Q') %>% 
    select(segments) %>% unnest(segments) %>% 
    select(start, duration, pitches)

investigations %>%
  mutate(pitches = map(pitches, compmus_normalise, 'chebyshev')) %>% 
    compmus_gather_chroma %>% 
    ggplot(
        aes(
            x = start + duration / 2, 
            width = duration, 
            y = pitch_class, 
            fill = value)) + 
    geom_tile() +
    labs(x = 'Time (s)', y = NULL, fill = 'Magnitude') + 
  theme_minimal() +
  ggtitle("Private Investigations: Pitches Used over Time")

```

***

Notable for the song *Private Investigations*, aside from its low loudness, is the fact that over the course of nearly 7 minutes, a very consistent drone on the note E is present. On certain points (like around the 2:15 mark) this E is the only note present in the song, which is clearly visible in the chromagram. Apart from the drone on E, the clearly distinguishable occurance of almost every other note is very notable. The harmonic development of the song crosses chords like Gdim7, A/C# and B7b9, despite being written in Em. This stands in stark contrast with the most of the other repertoire of both artists and pop music from that time (the 80s) in general. In this sense *Private Investigations* can be seen as a notable outlier in the repertoire of Dire Straits.

### 5. Using linear regression models show other differences between Dire Straits and Mark Knopfler {data-commentary-width=350}

***

*Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut fermentum imperdiet ultricies. Nulla et nulla vel tortor pharetra elementum et sed ex. Nullam eleifend orci convallis commodo gravida. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In porta orci eu aliquam scelerisque. Morbi turpis ipsum, ornare in lectus id, suscipit scelerisque elit. Nullam egestas nibh dolor, quis consectetur purus vulputate lobortis. Morbi sodales augue sed varius pellentesque. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Nullam erat lorem, suscipit sagittis pellentesque a, congue a est.*

*Quisque euismod velit id sem ornare semper. Integer gravida efficitur cursus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Vestibulum fermentum arcu sed nibh pharetra, id bibendum neque varius. Mauris quis augue ut nunc pulvinar vehicula sit amet id leo. Curabitur et ipsum est. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Maecenas ullamcorper eu nulla a vulputate.*

*Mauris vestibulum pretium sem, quis consectetur purus ullamcorper eget. Sed quis ante vitae felis dignissim mattis vulputate quis eros. Cras elit sapien, posuere et ullamcorper vitae, auctor suscipit ligula. Proin imperdiet dapibus tortor, nec ornare dolor sodales.* 

### 6. Conclusions and discussion {data-commentary-width=350}


