---
title: "Compmus2020"
author: "Erwin van Oostenbrugge"
output: 
  flexdashboard::flex_dashboard:
    storyboard: true
    theme: "paper"
    keep_md: true
---

```{r, echo = FALSE}
knitr::opts_chunk$set(
  fig.path = "README_figs/README-"
)
```

```{r setup, include=FALSE}
library(flexdashboard)
library(spotifyr)
library(tidyverse)
library(plotly)
source('Spotify.R')
library(compmus)
library(ggpubr)
library(rmarkdown)
```

```{r datasets}

knopfler <- get_artist_audio_features(artist = "Mark Knopfler")
direstraits <- get_artist_audio_features(artist = "Dire Straits")
combined <- 
  knopfler %>% bind_rows(direstraits)

knopfler2 <-
  get_playlist_audio_features('Mark Knopfler', '7Fx4RkUA16c1sf56GqDLNi') %>% slice(1:115) %>% add_audio_analysis()
direstraits2 <-
  get_playlist_audio_features('Dire Straits', '4De4uI5PG0MYqLftPmsQLW') %>% add_audio_analysis()
combined2 <- knopfler2 %>% mutate(Artist = "Mark Knopfler") %>% bind_rows(direstraits2 %>% mutate(Artist = "Dire Straits"))

investigations <- 
  get_tidy_audio_analysis('5KVak7r5YKcnkmARc0hy0Q') %>% 
    select(segments) %>% unnest(segments) %>% 
    select(start, duration, pitches)

sos <- 
    get_tidy_audio_analysis('37Tmv4NnfQeb0ZgUC4fOJj') %>% 
    compmus_align(bars, segments) %>% 
    select(bars) %>% unnest(bars) %>% 
    mutate(
        pitches = 
            map(segments, 
                compmus_summarise, pitches, 
                method = 'rms', norm = 'chebyshev')) %>% 
    mutate(
        timbre = 
            map(segments, 
                compmus_summarise, timbre, 
                method = 'rms', norm = 'euclidean'))

wii <- 
    get_tidy_audio_analysis('65f8Ca4HbZCMLhpZPTHW4O') %>% 
    compmus_align(bars, segments) %>% 
    select(bars) %>% unnest(bars) %>% 
    mutate(
        pitches = 
            map(segments, 
                compmus_summarise, pitches, 
                method = 'rms', norm = 'chebyshev')) %>% 
    mutate(
        timbre = 
            map(segments, 
                compmus_summarise, timbre, 
                method = 'rms', norm = 'euclidean'))

```

### 5. Dire Straits makes more compressed, bass-heavy music.{data-commentary-width=350}

```{r}

timbreplot <-
combined2 %>%
  mutate(
        timbre =
            map(
                segments,
                compmus_summarise,
                timbre,
                method = 'mean')) %>%
    select(playlist_name, timbre, track.name) %>% 
    compmus_gather_timbre %>% 
    group_by(playlist_name) %>%
    ggplot(aes(x = basis, y = value, label = track.name)) +
    geom_jitter(alpha = 0.1, shape = 1, aes(color = playlist_name)) + 
    scale_color_manual(values=c("Yellow", "Purple")) +
    geom_boxplot(outlier.color = "Grey", aes(fill = playlist_name)) + 
    scale_fill_viridis_d() +
    theme_minimal() +
    labs(x = 'Spotify Timbre Coefficients', y = '', fill = 'Artist', color = '')

ggplotly(timbreplot) %>%
  layout(boxmode = "group")


```

***

When looking at the means and standard deviations of timbre, we can clearly see that the difference in the use of MFCC c02 (lower frequencies) we saw between *Sultans of Swing* and *What it is* is typical for the two artists. Apart from that, there seems to be a somewhat less significant difference in the levels for c04 (quickly decaying attack) which went by largely unnoticed in the specific case studies last week. In general, Mark Knopfler seems to employ a bigger spectrum of timbral features than Dire Straits does, although only c05 seems to be consistently (and equally) prominent in the repertoires of both artists, which is the basis function for "scooped" lower-mid sounds in the spotify API. This naturally leads to lower levels for c06, which is a very mid-heavy MFCC with a slow attack.

In conclusion, both Mark Knopfler and Dire Straits use a mid-scooped sound, but the sounds in the music by Dire Straits is more compressed, leading to higher mean volumes and slower decay compared to Mark Knopfler, while also being more bass-heavy.

### 1. Introduction: Why is Dire Straits so much more succesful than Mark Knopfler?

Although Mark Knopfler has been at the helm for both Dire Straits and his own solo music as songwriter and main producer, Dire Straits has been much more successful than his own music. This leads me to believe that there are some key differences between the music of Dire Straits and the music of Mark Knopfler. I will look at musical and production differences in order to conclude which of these is the most different. This will give insight in why Mark Knopfler's solo project never got the success that ultimately ended Dire Straits.

The corpus I'm using is, quite obviously, the entire discographies by both artists, aquired by the get_artist_audio_features command from spotifyr. The question I intend to answer is: what are the fundamental differences between Mark Knopfler's music with Dire Straits and as a solo musician? 

### 2. The Spotify API skewes some data.{data-commentary-width=350}



```{r}

plot1 <-
  ggplot(combined, aes(x = acousticness, y = loudness, color = artist_name, label = track_name)) +
  geom_point()+
  geom_smooth(aes(color = artist_name))+
  theme_classic() +
  labs(color = "Artist") +
  ggtitle("Loudness in Relation to Acousticness")

ggplotly(plot1)

```


***

At first glance the primary difference between the two artists seems obvious: Mark Knopfler has produced more acoustic music. This is however where problems arise. Looking at the mean loudness for both artists, we would conclude that Dire Straits produced significantly louder music. This is not what would be expected, since louder mastering has become the standard and the means to do so have been developed over the years. This difference in loudness is not a stylistic feature of the music, but rather a consequence of the acousticness of the music, as can be seen in this plot. Notice how Mark Knopfler's music *in relation to its acousticness* is louder than the music of Dire Straits. 

*A lot of the softer tracks by Mark Knopfler are filmscores, which slightly skew the results shown in this graph. This is why I will not include those tracks when choosing an outlier for a chromagram.*

### 3. "Private Investigations" by Dire Straits is a unusually soft track, but nevertheless became a hit song. Loudness can't be the only factor. {data-commentary-width=350}

```{r}

investigations %>%
  mutate(pitches = map(pitches, compmus_normalise, 'chebyshev')) %>% 
    compmus_gather_chroma %>% 
    ggplot(
        aes(
            x = start + duration / 2, 
            width = duration, 
            y = pitch_class, 
            fill = value)) + 
    geom_tile() +
    labs(x = 'Time (s)', y = NULL, fill = 'Magnitude') + 
  theme_minimal() +
  ggtitle("Private Investigations: Pitches Used over Time")

```

***

Notable for the song *Private Investigations*, aside from its low loudness, is the fact that over the course of nearly 7 minutes, a very consistent drone on the note E is present. On certain points (like around the 2:15 mark) this E is the only note present in the song, which is clearly visible in the chromagram. Apart from the drone on E, the clearly distinguishable occurance of almost every other note is very notable. The harmonic development of the song crosses chords like Gdim7, A/C# and B7b9, despite being written in Em. This stands in stark contrast with the most of the other repertoire of both artists and pop music from that time (the 80s) in general. In this sense *Private Investigations* can be seen as a notable outlier in the repertoire of Dire Straits.

### 4. Mark Knopfler makes more timbrally diverse music for his solo project.{data-commentary-width=300}

```{r}


sos %>% 
    compmus_gather_timbre %>% 
    ggplot(
        aes(
            x = start + duration / 2, 
            width = duration, 
            y = basis, 
            fill = value)) + 
    geom_tile() +
    labs(x = 'Time (s)', y = NULL, fill = 'Magnitude') +
    scale_fill_viridis_c(option = 'E') +
    scale_fill_gradientn(limits = c(0,0.8), colors=c("black", "blue", "yellow")) +
    theme_minimal() + 
    ylab("MFCC") + labs(title = "Sultans of Swing - Dire Straits")


wii %>% 
    compmus_gather_timbre %>% 
    ggplot(
        aes(
            x = start + duration / 2, 
            width = duration, 
            y = basis, 
            fill = value)) + 
    geom_tile() +
    labs(x = 'Time (s)', y = NULL, fill = 'Magnitude') +
    scale_fill_viridis_c(option = 'E') +
    scale_fill_gradientn(limits = c(0,0.8), colors=c("black", "blue", "yellow")) +
    theme_minimal() + 
    ylab("MFCC") + labs(title = "What It Is - Mark Knopfler")

ggarrange(sos, wii)

```

***

To illustrate the differences and simmilarities between the two artists I've included cepstrograms of the most popular tracks of both artists according to spotify: *What it Is* by Mark Knopfler and *Sultans of Swing* by Dire Straits.

Looking at *Sultans of Swing*, it is interesting that there is a lot of activity in MFCC c02 during guitar solos. This is the range for bass frequencies, leading me to believe that a boosted bass is used to grant support to the guitar solo. More specifically, during the softer parts of the solo segments, there is a lot of activity here. Generally speaking, there is a correlation between loudness (MFCC c01) and bass-frequencies, probably meaning that loudness is (partially) measured in the presence of higher frequencies. The timbral diversity of *What it Is* is significantly greater than that of *Sultans of Swing*, although much of this diversity comes from the bridge around 160-200 seconds into the song. Perhaps this timbral diversity is one of the reasons for the relative lack of success for Mark Knopfler as a solo artist (compared to his time in Dire Straits). This would be due to the unpredictable nature of the sound that doesn't translate well to for instance radio broadcasting. 

Looking at MFCC c01, *What it Is* displays more dynamic diversity than *Sultans of Swing*, although it is the louder song overall. This is in line with the trends I've discovered in the previous weeks. 


### 6. Conclusions and discussion {data-commentary-width=350}


